import{r as a,j as n,c as $}from"./script-n-modules.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function r(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?c.credentials="include":t.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(t){if(t.ep)return;t.ep=!0;const c=r(t);fetch(t.href,c)}})();const O="";function P(e){if(!e.ok)throw new Error("Серверная ошибка: данные недоступны")}const v=async e=>{try{const s=await fetch(`${O}${e}`);P(s);const r=await(s==null?void 0:s.text());return r?JSON.parse(r):null}catch(s){return console.error(s),null}},E="";function I(e){if(!e.ok)throw new Error("Серверная ошибка: данные недоступны")}const x=async(e,s={},r="")=>{try{const i=await fetch(`${E}${e}`,{method:"POST",headers:{Accept:r,"Content-Type":r||"application/json"},body:JSON.stringify(s)});I(i);const t=await i;return r?t==null?void 0:t.blob():t==null?void 0:t.text()}catch(i){return console.error(i),null}};function M(e){return n.jsx("button",{onClick:()=>{e.func(e.info)},style:{fontWeight:e.selectType?"bold":""},children:e.name})}const j=a.memo(M);let R=(e,s="голос",r="голоса",i="голосов")=>{const t=e%100;if(t>=11&&t<=19)return i;const c=e%10;return c===1?s:c>=2&&c<=4?r:i};function T(e){return n.jsxs("tr",{children:[n.jsx("td",{children:`${e.id}`}),n.jsx("td",{children:`${e.name}`}),n.jsx("td",{children:`${e.votes} ${R(e.votes)}`})]})}const B=a.memo(T),h={stat:"/stat",variants:"/variants",vote:"/vote",download:"/download"},y={XML:{name:"XML",mimeType:"application/xml"},HTML:{name:"HTML",mimeType:"text/html"},JSON:{name:"JSON",mimeType:"application/json"}};function A(e,s){const r=document.createElement("a");r.href=URL.createObjectURL(new Blob([e])),r.download=s,r.click(),URL.revokeObjectURL(r.href)}function S(){const[e,s]=a.useState([]),[r,i]=a.useState([]),[t,c]=a.useState(y.JSON),u=o=>{v(o).then(l=>s(l))},p=(o,l)=>{x(o,l).then(m=>i(JSON.parse(m)))},b=a.useCallback(o=>{x(h.vote,{idVote:o}).then(()=>p(h.stat))},[]),w=a.useCallback(()=>{x(h.download,void 0,t==null?void 0:t.mimeType).then(o=>A(o,`file.${t==null?void 0:t.name.toLowerCase()}`))},[t]),N=o=>{c(y[o])};a.useEffect(()=>(u(h.variants),p(h.stat),()=>{}),[]);const g=a.useCallback(o=>{var l;return(l=e==null?void 0:e.find(m=>m.id===o))==null?void 0:l.name},[e]),L=a.useMemo(()=>Object.entries(y).map(([o,l])=>n.jsx(j,{name:l.name,func:N,info:l.name,selectType:l.name===t.name},o)),[t]),f=a.useMemo(()=>e==null?void 0:e.map(o=>n.jsx(j,{name:o.name,func:b,info:o.id},o.id+10)),[b,e]),d=a.useMemo(()=>r==null?void 0:r.map(o=>{let l=g(o.id);return n.jsx(B,{id:o.id,votes:o.votes,name:l},o.id+100)}),[r,g]);return n.jsxs("div",{className:"container",children:[n.jsx("h2",{children:"Голосование"}),n.jsx("div",{style:{display:!e&&!d?"block":"none"},children:"Ошибка загрузки данных"}),n.jsxs("div",{className:"info-box",style:{display:(e==null?void 0:e.length)>0&&(d==null?void 0:d.length)>0?"block":"none"},children:[n.jsx("h3",{children:"Статистика:"}),n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"ID"}),n.jsx("th",{children:"Позиция"}),n.jsx("th",{children:"Количество голосов"})]})}),n.jsx("tbody",{children:d})]})]}),n.jsxs("div",{className:"btn-vote",style:{display:(f==null?void 0:f.length)>0?"block":"none"},children:[n.jsx("h3",{children:"Проголосовать:"}),f]}),n.jsxs("div",{className:"btn-download",style:{display:(e==null?void 0:e.length)>0||(d==null?void 0:d.length)>0?"block":"none"},children:[n.jsx("h3",{children:"Тип получения данных:"}),L,n.jsx("h3",{children:"Скачать результаты:"}),n.jsx(j,{name:`Скачать ${t==null?void 0:t.name}`,func:w},"downloadBtn")]})]})}$.createRoot(document.getElementById("root")).render(n.jsx(S,{}));
