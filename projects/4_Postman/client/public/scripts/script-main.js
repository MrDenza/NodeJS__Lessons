import{j as t,r as h,c as U}from"./script-n-modules.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();const J={GET:{classN:"favorite-pos_get"},POST:{classN:"favorite-pos_post"}};function q(e){var o;return((o=J[e])==null?void 0:o.classN)||""}function I(e){var r;const o=(r=e.method)==null?void 0:r.toUpperCase();return t.jsxs("div",{className:`favorite-pos ${q(o)}`,onClick:()=>{e.openPosition(e.idPos)},children:[t.jsxs("span",{className:"favorite-pos_text-bold",children:["Метод: ",o]}),t.jsx("span",{children:e.url})]})}function M(e){const r=(Array.isArray(e.dataList)?e.dataList:[]).map((n,s)=>t.jsx(I,{idPos:s,method:n.method,url:n.url,openPosition:e.openPosition},s));return t.jsxs("div",{className:"favorite-box",children:[t.jsx("span",{className:"favorite-box__title",children:"Избранное:"}),t.jsx("div",{className:"favorite-box__list",children:r})]})}const $=h.memo(M);function H(e){var o,r;return t.jsxs("tr",{className:"row-data__box",children:[t.jsx("td",{children:t.jsx("label",{children:e.isOptions?t.jsxs("select",{value:(o=e.options)!=null&&o.includes(e.name)?e.name:"",onChange:n=>e.onChange(e.id,"name",n.target.value,e.isOptions),children:[t.jsx("option",{value:"",disabled:!0,children:"Выберите заголовок:"},"200"),(r=e.options)==null?void 0:r.map(n=>t.jsx("option",{value:n,disabled:e.usedOptions.includes(n)&&n!==e.name,children:n},n))]}):t.jsx("input",{type:"text",value:e.name||"",onChange:n=>e.onChange(e.id,"name",n.target.value)})})}),t.jsx("td",{children:t.jsx("label",{children:t.jsx("input",{type:"text",value:e.value||"",onChange:n=>e.onChange(e.id,"value",n.target.value,e.isOptions)})})}),t.jsx("td",{children:t.jsx("button",{onClick:n=>e.onDelete(n,e.id,e.isOptions),children:"Удалить"})})]})}const R=h.memo(H);function K(e){var r;const o=(e.data||[]).map((n,s)=>{const i=Object.keys(n),c=i.length>0?i[0]:"";return t.jsx(R,{id:s,name:c||"",value:n[c],onChange:e.onChange,onDelete:e.onDelete},s)});return t.jsxs("div",{className:"get-body__box",children:[t.jsx("span",{className:"get-body__title",children:"Параметры"}),t.jsxs("table",{children:[((r=e.data)==null?void 0:r.length)>0&&t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Ключ"}),t.jsx("th",{children:"Значение"}),t.jsx("th",{})]})}),t.jsx("tbody",{children:o})]}),t.jsx("button",{onClick:n=>{e.onAdd(n)},children:"Добавить параметр"})]})}const G=h.memo(K);function z(e){return t.jsxs("div",{className:"post-body__box",children:[t.jsx("span",{className:"post-body__title",children:"Тело запроса:"}),t.jsx("textarea",{className:"post-body__textarea",value:e.body,onChange:o=>e.onChange(o.target.value),placeholder:"Тело запроса должно быть в формате JSON"})]})}const Q=h.memo(z),V=!0;function X(e){var r;const o=(e.data||[]).map((n,s)=>{const i=Object.keys(n),c=i.length>0?i[0]:"",x=e.data.map(j=>Object.keys(j)[0]).filter(j=>j!==c);return t.jsx(R,{id:s,name:c,value:n[c],isOptions:V,options:e.headers,usedOptions:x,onChange:e.onChange,onDelete:e.onDelete},s)});return t.jsxs("div",{className:"head-body__box",children:[t.jsx("span",{className:"head-body__title",children:"Заголовки"}),t.jsxs("table",{children:[((r=e.data)==null?void 0:r.length)>0&&t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Заголовок"}),t.jsx("th",{children:"Значение"}),t.jsx("th",{})]})}),t.jsx("tbody",{children:o})]}),t.jsx("button",{onClick:n=>e.onAdd(n,V),children:"Добавить заголовок"})]})}const D=["GET","POST"],T=["Accept","Cookie","Content-Encoding","Content-Language","Content-Type"],k={method:"",url:"",query:[],body:"",headers:[]},y={method:{nullField:"Выберите метод запроса!",noValidMethod:"Выбранный метод не доступен!"},url:{nullField:"Введите URL запроса!",noValidUrl:"Некорректный формат URL!"},query:{errTypeValue:'Ошибка значений параметров! Удалите все пары "ключ-значение" и пересоздайте снова.',nullField:'Есть незаполненные поля! Заполните или удалите незаполненные пары "ключ-значение".',duplicateKey:'Нельзя использовать несколько пар "ключ-значение" с одинаковыми ключами!'},body:{noValidBody:"Некорректный формат JSON!",noCorrectBody:"Некорректный формат JSON! JSON должен быть объектом/массивом."},headers:{errTypeValue:'Ошибка значений заголовков! Удалите все пары "заголовок-значение" и пересоздайте снова.',nullField:'Есть незаполненные поля! Заполните или удалите незаполненные пары "заголовок-значение".',noValidHeader:"Есть некорректные заголовки! Выберите заголовки из доступного списка.",duplicateKey:'Нельзя использовать несколько пар "заголовок-значение" с одинаковыми заголовками!'}},Y={method:e=>e?D.includes(e.toUpperCase())?!1:y.method.noValidMethod:y.method.nullField,url:e=>{if(!e)return y.url.nullField;if(URL.canParse)return URL.canParse(e)?!1:y.url.noValidUrl;try{return new URL(e),!1}catch{return y.url.noValidUrl}},query:e=>{if(!(Array.isArray(e)&&e.every(i=>typeof i=="object"&&Object.keys(i).length===1)))return y.query.errTypeValue;const r=e.map(i=>Object.keys(i)[0]);return r.length!==new Set(r).size?y.query.duplicateKey:e.some(i=>Object.entries(i).some(([c,x])=>!c.trim()||!x.toString().trim()))?y.query.nullField:!1},body:e=>{if(!e.length)return!1;try{const o=JSON.parse(e);return typeof o=="object"&&o!==null?!1:y.body.noCorrectBody}catch{return y.body.noValidBody}},headers:e=>{if(!(Array.isArray(e)&&e.every(s=>typeof s=="object"&&Object.keys(s).length===1)))return y.headers.errTypeValue;const r=e.map(s=>Object.keys(s)[0]);if(r.length!==new Set(r).size)return y.headers.duplicateKey;for(const s of e){const[[i,c]]=Object.entries(s);if(!i.trim())return y.headers.nullField;if(!T.includes(i))return y.headers.noValidHeader;if(!c.toString().trim())return y.headers.nullField}return!1}};function W(e){return!e||typeof e!="object"||Array.isArray(e)||Object.keys(e).length===0}function Z(e){var v;const[o,r]=h.useState(k),[n,s]=h.useState({}),i=((v=o.method)==null?void 0:v.toUpperCase())||"";h.useEffect(()=>{W(e.dataReq)||(r(e.dataReq),s({}))},[e.dataReq]);const c=l=>{let a={};for(let d in l){let u=Y[d](l[d]);u&&(a[d]=u)}return s(a),!Object.keys(a).length},x=l=>{if(l.preventDefault(),c(o))return e.sendDataReq(o)},j=l=>{l.preventDefault(),r(k),s({})},p=()=>{if(c(o))return e.saveDataReq(o)},E=l=>{const a=typeof l.target.value=="string"?l.target.value.toLowerCase():"";r(d=>{let u={...d};return u.method=a,a==="get"?"body"in u&&(u.body=""):"query"in u&&(u.query=[]),u}),s({})},m=l=>{const a=typeof l.target.value=="string"?l.target.value.trim():"";r(d=>d.url===a?d:{...d,url:a})},N=(l,a,d,u)=>{const L=u?"headers":"query",f=typeof d=="string"?d.trim():"";r(O=>{const C=JSON.parse(JSON.stringify(O[L])),g=JSON.parse(JSON.stringify(C[l])),S=Object.keys(g)[0];if(a==="name"){if(S===f)return O;const B=g[S];delete g[S],g[f]=B}else if(a==="value"){if(g[S]===f)return O;g[S]=f}return C[l]=g,{...O,[L]:C}})},_=(l,a,d)=>{l.preventDefault();const u=d?"headers":"query";console.log(`Удалён элемент из ${u} с id: ${a+1}`),r(L=>{const f=JSON.parse(JSON.stringify(L));return f[u]=f[u].filter((O,C)=>C!==a),f})},b=(l,a)=>{l.preventDefault();const d=a?"headers":"query";r(u=>({...u,[d]:[...Array.isArray(u[d])?u[d]:[],{"":""}]}))},A=l=>{const a=typeof l=="string"?l.trim():"";r(d=>d.body===a?d:{...d,body:a})},F=D.map((l,a)=>t.jsx("option",{value:l,children:l},a));return t.jsxs("form",{id:"formReq",onSubmit:x,onReset:j,className:"control-box__form",children:[t.jsxs("table",{className:"control-box__table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"control-box__table-method",children:t.jsx("label",{htmlFor:"method",children:"Метод"})}),t.jsx("th",{className:"control-box__table-url",children:t.jsx("label",{htmlFor:"url",children:"URL"})})]})}),t.jsx("tbody",{children:t.jsxs("tr",{children:[t.jsx("td",{children:t.jsxs("select",{id:"method",className:"table-method__input",value:i,onChange:E,children:[t.jsx("option",{value:"",disabled:!0,children:"Выберите метод:"},"100"),F]})}),t.jsx("td",{children:t.jsx("input",{type:"text",id:"url",className:"table-url__input",value:(o==null?void 0:o.url)||"",onChange:m})})]})})]}),t.jsx("div",{className:"control-box_text-err",children:n==null?void 0:n.method}),t.jsx("div",{className:"control-box_text-err",children:n==null?void 0:n.url}),t.jsx("hr",{}),i==="GET"&&t.jsxs(h.Fragment,{children:[t.jsx(G,{data:o==null?void 0:o.query,onChange:N,onDelete:_,onAdd:b}),t.jsx("div",{className:"control-box_text-err",children:n==null?void 0:n.query})]}),i==="POST"&&t.jsxs(h.Fragment,{children:[t.jsx(Q,{body:o==null?void 0:o.body,onChange:A}),t.jsx("div",{className:"control-box_text-err",children:n==null?void 0:n.body})]}),i&&t.jsx("hr",{}),i&&t.jsxs(h.Fragment,{children:[t.jsx(X,{data:o==null?void 0:o.headers,headers:T,onChange:N,onDelete:_,onAdd:b}),t.jsx("div",{className:"control-box_text-err",children:n==null?void 0:n.headers})]}),i&&t.jsx("hr",{}),t.jsxs("div",{className:"control-box__btn",children:[t.jsx("button",{type:"button",onClick:p,children:"Сохранить запрос"}),t.jsx("button",{type:"submit",children:"Отправить запрос"}),t.jsx("button",{type:"reset",children:"Сбросить форму"})]})]})}const ee=h.memo(Z);function te(e){return t.jsx("div",{})}const ne=h.memo(te);function se(e){return t.jsxs("div",{className:"control-box",children:[t.jsx(ee,{dataReq:e.dataReq,sendDataReq:e.sendDataReq,saveDataReq:e.saveDataReq}),t.jsx(ne,{dataRes:e.dataRes})]})}const oe=h.memo(se),re="";function ie(e){if(!e.ok)throw new Error("Серверная ошибка: данные недоступны")}const le=async(e,o={},r="")=>{try{const n=await fetch(`${re}${e}`,{method:"POST",headers:{Accept:r,"Content-Type":r||"application/json"},body:JSON.stringify(o)});ie(n);const s=await n;return r?s==null?void 0:s.blob():s==null?void 0:s.text()}catch(n){return console.error(n),null}},w={getDataList:"/datalist"};function P(e){var r;const o=n=>(n==null?void 0:n.map(s=>{const i=Object.entries(s);return i.sort(([c],[x])=>c.localeCompare(x)),JSON.stringify(i)}).sort().join("|"))||"";return{method:e.method.toLowerCase(),url:e.url.toLowerCase().trim(),body:((r=e.body)==null?void 0:r.trim())||"",query:o(e.query),headers:o(e.headers)}}function ae(e,o){const r=P(e);return o.some(n=>{const s=P(n);return s.method===r.method&&s.url===r.url&&s.body===r.body&&s.query===r.query&&s.headers===r.headers})}function de(){const[e,o]=h.useState([]),[r,n]=h.useState({}),[s,i]=h.useState({}),c=(m,N,_)=>{const b=window.localStorage.getItem("id"),A=b?{id:b}:{},F=_?{...A,add:_}:A;le(m,F).then(v=>{try{const l=JSON.parse(v);l.id&&window.localStorage.setItem("id",String(l.id)),Array.isArray(l.list)&&l.list.length>0&&N(l.list)}catch(l){console.error("Ошибка парсинга ответа:",l)}}).catch(v=>{console.error("Ошибка запроса:",v)})},x=(m,N)=>{c(m,b=>{o(b)},N)};h.useEffect(()=>(x(w.getDataList),()=>{}),[]);const j=m=>{console.log("submit"),n({...m})},p=m=>{if(ae(m,e))return alert("Такой запрос уже есть в избранном!");x(w.getDataList,m)},E=m=>{n(e[m])};return t.jsxs("div",{className:"container",children:[t.jsx($,{dataList:e,openPosition:E}),t.jsx(oe,{dataReq:r,dataRes:s,sendDataReq:j,saveDataReq:p})]})}U.createRoot(document.getElementById("root")).render(t.jsx(de,{}));
