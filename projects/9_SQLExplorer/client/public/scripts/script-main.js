import{r as d,j as s,c as f}from"./script-n-modules.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();function m(l){const[i,r]=d.useState(""),[a,e]=d.useState(""),t=o=>{o.preventDefault(),o.target.query.value?(l.sendQuery(o.target.query.value),e("")):e("Введите SQL-запрос!")},n=o=>{r(o.target.value)};return s.jsxs("form",{onSubmit:o=>{t(o)},className:"app__form-box",children:[s.jsx("textarea",{id:"sql-query",placeholder:"Введите SQL-запрос",name:"query",className:"app__form-query",onChange:o=>n(o),value:i}),s.jsx("span",{className:"app__form-err",children:a}),s.jsx("button",{type:"submit",className:"app__form-btn",children:"Выполнить"})]})}function y(l){const{isLoading:i,dataResult:r}=l,a=(e,t)=>s.jsxs("table",{className:"app__result-table",children:[s.jsx("thead",{children:s.jsx("tr",{children:e.map(n=>s.jsx("th",{children:n},n))})}),s.jsx("tbody",{children:t.map((n,o)=>s.jsx("tr",{children:e.map(u=>s.jsx("td",{children:n[u]},u))},o))})]});return i?s.jsx("div",{className:"app__result-box",children:s.jsxs("div",{className:"animation__dot-pulse",children:[s.jsx("span",{}),s.jsx("span",{}),s.jsx("span",{})]})}):!r||Object.keys(r).length===0?s.jsx("div",{className:"app__result-box"}):s.jsx("div",{className:"app__result-box",children:r.type==="table"&&r.columns&&r.rows?a(r.columns,r.rows):r.type==="modify"&&s.jsxs("div",{className:"app__result-modify",children:["Изменено строк: ",r.affectedRows]})||r.type==="error"&&s.jsx("div",{className:"app__result-err",children:r.error})||s.jsx("div",{className:"app__result-err",children:"Результат: Неподдерживаемый тип данных!"})})}const x="",h=async(l,i={},r="")=>{const a=await fetch(`${x}${l}`,{method:"POST",headers:{Accept:r,"Content-Type":r||"application/json"},body:JSON.stringify(i)}),e=a.headers.get("Content-Type")||"";let t;if(e.includes("application/json")?t=await a.json():e.startsWith("text/")?t=await a.text():e.includes("application/octet-stream")||e.includes("application/pdf")||e.includes("image/")||e.includes("audio/")||e.includes("video/")?t=await a.blob():t=await a.text(),!a.ok){const n=t&&t.error?t.error:a.statusText,o=new Error(n);throw o.status=a.status,o.body=t,o}return t},j={sendSqlQuery:"/api/sql"};function _(){const[l,i]=d.useState({}),[r,a]=d.useState(!1),e=(n,o,u)=>{h(n,{type:"query",sqlQuery:o}).then(c=>{c&&c.type==="error"&&console.error("Ошибка SQL-запроса:",c.error),u(c)}).catch(c=>{console.error(`Ошибка SQL-запроса: ${c.message}`);const p=c.body??{type:"error",error:c.message};u(p)}).finally(()=>{a(!1)})},t=d.useCallback(n=>{let o=u=>{i(u)};a(!0),e(j.sendSqlQuery,n,o)},[]);return s.jsxs("div",{className:"container",children:[s.jsx("h1",{className:"app__title",children:"SQLExplorer"}),s.jsx(m,{sendQuery:t}),s.jsx(y,{isLoading:r,dataResult:l})]})}f.createRoot(document.getElementById("root")).render(s.jsx(_,{}));
