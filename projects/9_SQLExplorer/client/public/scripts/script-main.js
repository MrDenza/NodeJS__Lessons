import{r as d,j as s,c as f}from"./script-n-modules.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();function m(i){const[l,r]=d.useState(""),[n,e]=d.useState(""),t=o=>{o.preventDefault(),o.target.query.value?(i.sendQuery(o.target.query.value),e("")):e("Введите SQL-запрос!")},a=o=>{r(o.target.value)};return s.jsxs("form",{onSubmit:o=>{t(o)},className:"app__form-box",children:[s.jsx("textarea",{id:"sql-query",placeholder:"Введите SQL-запрос",name:"query",className:"app__form-query",onChange:o=>a(o),value:l}),s.jsx("span",{className:"app__form-err",children:n}),s.jsx("button",{type:"submit",className:"app__form-btn",children:"Выполнить"})]})}function y(i){const{isLoading:l,dataResult:r}=i,n=(e,t)=>s.jsxs("table",{className:"app__result-table",children:[s.jsx("thead",{children:s.jsx("tr",{children:e.map(a=>s.jsx("th",{children:a},a))})}),s.jsx("tbody",{children:t.map((a,o)=>s.jsx("tr",{children:e.map(u=>s.jsx("td",{children:a[u]},u))},o))})]});return l?s.jsx("div",{className:"app__result-box",children:s.jsxs("div",{className:"animation__dot-pulse",children:[s.jsx("span",{}),s.jsx("span",{}),s.jsx("span",{})]})}):!r||Object.keys(r).length===0?s.jsx("div",{className:"app__result-box"}):s.jsx("div",{className:"app__result-box",children:r.type==="table"&&r.columns&&r.rows?n(r.columns,r.rows):r.type==="modify"&&s.jsxs("div",{className:"app__result-modify",children:["Изменено строк: ",r.affectedRows]})||r.type==="error"&&s.jsx("div",{className:"app__result-err",children:r.error})||s.jsx("div",{className:"app__result-err",children:"Результат: Неподдерживаемый тип данных!"})})}const x="",h=async(i,l={},r="")=>{const n=await fetch(`${x}${i}`,{method:"POST",headers:{Accept:r,"Content-Type":r||"application/json"},body:JSON.stringify(l)}),e=n.headers.get("Content-Type")||"";let t;if(e.includes("application/json")?t=await n.json():e.startsWith("text/")?t=await n.text():e.includes("application/octet-stream")||e.includes("application/pdf")||e.includes("image/")||e.includes("audio/")||e.includes("video/")?t=await n.blob():t=await n.text(),!n.ok){const a=t&&t.error?t.error:n.statusText,o=new Error(a);throw o.status=n.status,o.body=t,o}return t},j={sendSqlQuery:"/api/sql"};function _(){const[i,l]=d.useState({}),[r,n]=d.useState(!1),e=(a,o,u)=>{h(a,{type:"query",sqlQuery:o}).then(c=>{c&&c.type==="error"&&console.error("Ошибка SQL-запроса:",c.error),u(c)}).catch(c=>{console.error(`Ошибка SQL-запроса: ${c.message}`);const p=c.body??{type:"error",error:c.message};u(p)}).finally(()=>{n(!1)})},t=d.useCallback(a=>{let o=u=>{l(u)};n(!0),e(j.sendSqlQuery,a,o)},[]);return console.log(i),s.jsxs("div",{className:"container",children:[s.jsx("h1",{className:"app__title",children:"SQLExplorer"}),s.jsx(m,{sendQuery:t}),s.jsx(y,{isLoading:r,dataResult:i})]})}f.createRoot(document.getElementById("root")).render(s.jsx(_,{}));
